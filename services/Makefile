all: modules build

USER_DOCKER_IMAGE_NAME=nailkabirov/arch-hw5
USER_DOCKER_IMAGE_TAG=v0.0.1

APP_NAMES = \
	user

.PHONY: modules
modules:
	go mod tidy

.PHONY: build
build:
	docker build -t $(USER_DOCKER_IMAGE_NAME):$(USER_DOCKER_IMAGE_TAG) -f User.Dockerfile .

.PHONY: build_local
build_local: modules check
	$(foreach name, $(APP_NAMES), CGO_ENABLED=0 GOOS=linux GOARCH=amd64 go build -v -o ./bin/$(name) ./cmd/$(name)/;)

.PHONY: clean
clean:
	rm -f $(foreach name,$(APP_NAMES), "bin/$(name)")

.PHONY: check
check:
	golangci-lint run